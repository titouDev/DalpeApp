{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "employes",
        "models": [
            "employe"
        ],
        "stores": [
            "employes",
            "clients"
        ],
        "views": [
            "editEmployeWindow"
        ]
    },
    "designerId": "8953454d-3ea4-4a30-ad4c-01f5587be068",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#employesGrid #addEmploye",
                "designer|targetType": "Ext.button.Button",
                "fn": "onAddEmployeClick",
                "implHandler": [
                    "Ext.widget('editEmployeWindow').show();"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onAddEmployeClick",
            "designerId": "bc194fc4-24d8-43e9-b54c-75bb5208f964"
        },
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "employesGrid",
                "selector": "#employesGrid"
            },
            "name": "employesGrid",
            "designerId": "09832666-8827-4a98-bea8-c0804df0a59e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#employesGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onEmployesGridSelect",
                "implHandler": [
                    "var hours_store = Ext.getStore('employes_hours');",
                    "hours_store.load({params:{employeId:record.data.id}});"
                ],
                "name": "itemclick",
                "scope": "me"
            },
            "name": "onEmployesGridSelect",
            "designerId": "12f27b2a-1e5e-4e39-b817-a700b1341f58"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#employesPanel",
                "designer|targetType": "Ext.panel.Panel",
                "fn": "onEmployesPanelActivate",
                "implHandler": [
                    "this.getEmployesStore().load();    ",
                    ""
                ],
                "name": "activate",
                "scope": "me"
            },
            "name": "onEmployesPanelActivate",
            "designerId": "7b0c2fd1-d713-48d4-b012-19efe85fd3a4"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#editEmploye",
                "designer|targetType": "Ext.button.Button",
                "fn": "onEditEmployeClick",
                "implHandler": [
                    "//On prend le record selectionne",
                    "var selectedRecord = this.getEmployesGrid().selModel.getSelection()[0];",
                    "if (!selectedRecord) {",
                    "    Ext.Msg.alert('Attention','Vous devez selectionner un employe...').setWidth(200);",
                    "    return;",
                    "}",
                    "",
                    "//On affiche la fenetre d'edit",
                    "var editEmployeWindow = Ext.widget('editEmployeWindow');",
                    "",
                    "//On load le soustraitant selecitonne dans le form",
                    "var myForm = editEmployeWindow.down('form');",
                    "",
                    "//On retourne chercher le data dans la db, au cas ou un autre user ait modifie la fiche",
                    "var employeModel = this.getEmployeModel();",
                    "employeModel.load(selectedRecord.get('id'),{",
                    "    scope:this,",
                    "    callback:function(employe){",
                    "        myForm.getForm().loadRecord(employe);",
                    "    }",
                    "});",
                    "",
                    "editEmployeWindow.show();",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onEditEmployeClick",
            "designerId": "52b02d62-2b56-4858-82d8-fbe4533f8aa1"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "editEmployeWindow #annuler",
                "designer|targetType": "Ext.button.Button",
                "fn": "onAnnulerClick",
                "implHandler": [
                    "button.up('window').close();"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onAnnulerClick",
            "designerId": "9fc57f93-e58f-48a9-9a22-0abcbe0f5ef0"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "editEmployeWindow #enregistrer",
                "designer|targetType": "Ext.button.Button",
                "fn": "onEnregistrerClick",
                "implHandler": [
                    "//On va chercher les infos du form",
                    "var myForm = Ext.getCmp('editEmployeWindow').down('form').getForm();",
                    "if (! myForm.isValid()) {",
                    "    return;",
                    "}",
                    "",
                    "var record = myForm.getRecord();",
                    "if (!record) {",
                    "    var employeModel = this.getEmployeModel();    ",
                    "    record = new employeModel();",
                    "}",
                    "record.set(myForm.getValues());",
                    "if (!record.get('id')) {",
                    "    //POST",
                    "    record.getProxy().appendId=false; //bug fix pour eviter d'appender un slah a la fin de l'url",
                    "}",
                    "",
                    "record.save({",
                    "    scope:this,",
                    "    callback:function(){",
                    "        button.up('window').close();",
                    "        this.getEmployesGrid().store.load();",
                    "    }",
                    "});",
                    "record.getProxy().appendId=true;",
                    "",
                    "",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onEnregistrerClick",
            "designerId": "8e5cf0df-2ccd-4182-bb26-4a5a07ee5f16"
        }
    ]
}
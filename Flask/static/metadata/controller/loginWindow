{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "loginWindow"
    },
    "designerId": "c53357d6-6534-42c5-8bea-8fd0205ff613",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#loginWindow #login",
                "designer|targetType": "Ext.button.Button",
                "fn": "onLoginClick",
                "implHandler": [
                    "var myForm = button.up('window').down('form').getForm();",
                    "this.sendLoginForm(myForm);"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLoginClick",
            "designerId": "e30a04bc-5d65-4e69-8680-6f1ac0a8d81b"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#appViewport #logout",
                "designer|targetType": "Ext.button.Button",
                "fn": "onLogoutButtonClick",
                "implHandler": [
                    "this.logOut();",
                    "window.onbeforeunload=undefined;",
                    "window.location.reload();"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onLogoutButtonClick",
            "designerId": "b42887a5-0963-4a87-b99b-2c699b3b3ca4"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "response"
                ],
                "fn": "verifyInfos",
                "implHandler": [
                    "if (response.length) {",
                    "    user_logged = response[0].id;",
                    "    //L'authentification a fonctionne, on peut rentrer dans l'application",
                    "    dalpeApp.app.applyStateProviderInfos(user_logged);",
                    "    Ext.getCmp('loginWindow').close();",
                    "    var myAppToolbar = Ext.getCmp('appToolbar');",
                    "    myAppToolbar.down('#userLogged').setText('Utilisateur connect√©: ' + response[0].prenom + \" \" + response[0].nom);",
                    "}",
                    "else {",
                    "    Ext.Msg.alert('Attention', 'Nom d\\'utilisateur ou mot de passe incorrects.');",
                    "}"
                ]
            },
            "name": "verifyInfos",
            "designerId": "f13991b0-3a89-4e76-ba49-45bb4e34d198"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#loginWindow #password",
                "designer|targetType": "Ext.form.field.Text",
                "fn": "onPasswordSpecialkey",
                "implHandler": [
                    "if (e.button === 12) {",
                    "    //ENTER KEY",
                    "    var myForm = Ext.ComponentQuery.query('#loginWindow  form')[0].getForm();",
                    "    this.sendLoginForm(myForm);",
                    "}"
                ],
                "name": "specialkey",
                "scope": "me"
            },
            "name": "onPasswordSpecialkey",
            "designerId": "144e3f9e-2a0c-4eb9-ba85-a0f0c1ec3b71"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "myForm"
                ],
                "fn": "sendLoginForm",
                "implHandler": [
                    "if (!myForm.isValid()) {",
                    "    return;",
                    "}",
                    "var me = this;",
                    "//On verifie l'identification dans la base de donnees...",
                    "myForm.submit({",
                    "    success:function(form, action){",
                    "        me.credentialsApproved(action.result.user.login);",
                    "        window.onbeforeunload=undefined;",
                    "        window.location.reload();",
                    "    },",
                    "    failure:function(){",
                    "",
                    "        Ext.Msg.show({",
                    "            title:'Erreur',",
                    "            msg: \"Nom d'utilisateur ou mot de passe incorrects.\",",
                    "            buttons: Ext.Msg.YES,",
                    "            buttonText:{yes:'OK'},",
                    "            icon: Ext.Msg.ERROR",
                    "        });",
                    "    }",
                    "});",
                    ""
                ]
            },
            "name": "sendLoginForm",
            "designerId": "c7e15f9c-b4e2-42ad-9a76-f670f34deabf"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "getUserLogged",
                "implHandler": [
                    "return Ext.util.Cookies.get('dalpeApp.userLogged');"
                ]
            },
            "name": "getUserLogged",
            "designerId": "209b2e64-d2a0-45be-b3b4-1c4b5b98a10f"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "isLogged",
                "implHandler": [
                    "return Ext.util.Cookies.get('dalpeApp.userLogged') ? true : false;"
                ]
            },
            "name": "isLogged",
            "designerId": "77ef0632-5c5a-4662-a063-b19d1ef45ebe"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "isFirstUser",
                "implHandler": [
                    "return this.getController('logHours').loadEmployes()",
                    ".then(function(employes){",
                    "    return RSVP.resolve(employes.length === 0 ? true : false);",
                    "});"
                ]
            },
            "name": "isFirstUser",
            "designerId": "86ad5017-080c-4d95-b496-1cfe53012b4d"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|params": [
                    "userName"
                ],
                "fn": "credentialsApproved",
                "implHandler": [
                    "Ext.util.Cookies.set('dalpeApp.userLogged', userName);"
                ]
            },
            "name": "credentialsApproved",
            "designerId": "e282767b-e7a0-447a-bb21-6d485b15ab85"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "logOut",
                "implHandler": [
                    "Ext.util.Cookies.clear('dalpeApp.userLogged')"
                ]
            },
            "name": "logOut",
            "designerId": "5c98cd25-9aec-48b6-aa73-dc12edafa655"
        }
    ]
}
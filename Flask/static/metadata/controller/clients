{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "designer|userClassName": "clients",
        "models": [
            "client"
        ],
        "stores": [
            "clients"
        ],
        "views": [
            "editClientWindow"
        ]
    },
    "designerId": "12caf886-dbf7-471f-b353-82f5b2c7f27f",
    "cn": [
        {
            "type": "controllerref",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "ref": "clientsGrid",
                "selector": "#clientsGrid"
            },
            "name": "clientsGrid",
            "designerId": "2d5ca41d-4909-4638-9b1d-158bd876f52f"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#clientsGrid #addClient",
                "designer|targetType": "Ext.button.Button",
                "fn": "onAddClick",
                "implHandler": [
                    "Ext.widget('editClientWindow').show();"
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onAddClick",
            "designerId": "b1e695ad-5d50-4bfd-9bc9-b34b5d0a3beb"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#editClientWindow #enregistrer",
                "designer|targetType": "Ext.button.Button",
                "fn": "onEnregistrerClick",
                "implHandler": [
                    "//On va chercher les infos du form",
                    "var myForm = Ext.getCmp('editClientWindow').down('form').getForm();",
                    "if (! myForm.isValid()) {",
                    "    return;",
                    "}",
                    "",
                    "",
                    "var record = myForm.getRecord();",
                    "if (!record) {",
                    "    var clientModel = this.getClientModel();    ",
                    "    record = new clientModel();",
                    "}",
                    "record.set(myForm.getValues());",
                    "if (!record.get('id')) {",
                    "    //POST",
                    "    record.getProxy().appendId=false; //bug fix pour eviter d'appender un slah a la fin de l'url",
                    "}",
                    "record.save({",
                    "    scope:this,",
                    "    callback:function(){",
                    "        button.up('window').close();",
                    "        this.getClientsGrid().store.load();",
                    "    }",
                    "});",
                    "record.getProxy().appendId=true;",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onEnregistrerClick",
            "designerId": "63276136-2eb3-4104-85ad-b7980b85500c"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#clientsGrid",
                "designer|targetType": "Ext.grid.Panel",
                "fn": "onClientsGridActivate",
                "implHandler": [
                    "this.getClientsStore().load();"
                ],
                "name": "activate",
                "scope": "me"
            },
            "name": "onClientsGridActivate",
            "designerId": "76677f0b-2963-4be7-9dd9-1b43c9d30471"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|controlQuery": "#editClient",
                "designer|targetType": "Ext.button.Button",
                "fn": "onEditClientClick",
                "implHandler": [
                    "//On prend le record selectionne",
                    "var selectedRecord = this.getClientsGrid().selModel.getSelection()[0];",
                    "if (!selectedRecord) {",
                    "    Ext.Msg.alert('Attention','Vous devez selectionner un client...').setWidth(200);",
                    "    return;",
                    "}",
                    "",
                    "//On affiche la fenetre d'edit",
                    "var editClientWindow = Ext.widget('editClientWindow');",
                    "",
                    "//On load le soustraitant selecitonne dans le form",
                    "var myForm = editClientWindow.down('form');",
                    "",
                    "//On retourne chercher le data dans la db, au cas ou un autre user ait modifie la fiche",
                    "var clientModel = this.getClientModel();   ",
                    "clientModel.load(selectedRecord.get('id'),{",
                    "    scope:this,",
                    "    callback:function(client){",
                    "        myForm.getForm().loadRecord(client);",
                    "    }",
                    "});",
                    "",
                    "editClientWindow.show();",
                    ""
                ],
                "name": "click",
                "scope": "me"
            },
            "name": "onEditClientClick",
            "designerId": "b422fe3a-8903-461e-863d-b1a545730d12"
        }
    ]
}
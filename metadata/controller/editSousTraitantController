{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "models": [
            "sousTraitant"
        ],
        "stores": [
            "sousTraitants"
        ],
        "designer|userClassName": "editSousTraitantController"
    },
    "designerId": "6e11ae97-e15a-45d4-9386-3d63092f49b8",
    "cn": [
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onSaveDocumentClick",
                "fn": "onSaveDocumentClick",
                "implHandler": [
                    "var myEditForm = button.up('window').down('#editForm').getForm();",
                    "var sousTraitantId = myEditForm.getValues().id;",
                    "",
                    "if (! sousTraitantId)",
                    "{",
                    "    Ext.Msg.alert('Attention','Vous devez d\\'abord créer un Sous Traitant pour enregistrer un document');",
                    "}",
                    "else",
                    "{",
                    "",
                    "    var form = button.up('#fileForm').getForm();",
                    "    if(form.isValid()){",
                    "        form.submit({",
                    "            url: 'document-upload.php',",
                    "            scope:this,",
                    "            timeout:100,",
                    "            params: {",
                    "                sousTraitantId: sousTraitantId,",
                    "                documentTypeId:form.getValues().documentTypeId,",
                    "                documentNote:form.getValues().documentNote",
                    "            },",
                    "            waitMsg: 'Sauvegarde du document...',",
                    "            success: function(fp, o) {",
                    "                //On reload le sotre de documents",
                    "                var documentsStore = Ext.getStore('documents');",
                    "                documentsStore.load();",
                    "                //Ext.Msg.alert('Succès', 'Le document \"' + o.result.file + '\" est enregistré.');",
                    "            }",
                    "        });",
                    "    }",
                    "}"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "#editSousTraitantWindow #saveDocument"
            },
            "designerId": "b98d2c6c-9023-4eab-b5ee-792dfb660b6a"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onEnregistrerClick",
                "fn": "onEnregistrerClick",
                "implHandler": [
                    "//On va chercher les infos du form",
                    "var myForm = Ext.getCmp('editSousTraitantWindow').down('form').getForm();",
                    "if (! myForm.isValid())",
                    "{",
                    "    return;",
                    "}",
                    "",
                    "//On update la DB et on ferme la window",
                    "SousTraitants.update(myForm.getValues(), function(){",
                    "    //On peut maintenant fermer la window",
                    "    button.up('window').close();",
                    "    //On pense a refresher le store des soustraitants",
                    "    this.getSousTraitantsStore().load();",
                    "},this);",
                    "",
                    ""
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "editSousTraitantWindow #enregistrer"
            },
            "designerId": "dd24a4d7-9838-40aa-9f09-97c21c4e1f0e"
        },
        {
            "type": "controlleraction",
            "reference": {
                "name": "listeners",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "designer|userClassName": "onAnnulerClick",
                "fn": "onAnnulerClick",
                "implHandler": [
                    "button.up('window').close();"
                ],
                "name": "click",
                "scope": "me",
                "designer|targetType": "Ext.button.Button",
                "designer|controlQuery": "editSousTraitantWindow #annuler"
            },
            "designerId": "f824b459-657a-4e1c-b324-1498d12204ee"
        }
    ]
}